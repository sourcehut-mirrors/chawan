.\" Automatically generated by Pandoc 3.8.1
.\"
.TH "CHA-TERMINAL" "7"
.SH Chawan terminal compatibility
Chawan does not use termcap, terminfo, or ncurses; it relies solely on
built\-in terminal handling routines, mostly inspired by notcurses.
.SS XTerm compatibility
In general, Chawan assumes an XTerm\-compatible environment where XTerm
means the current XTerm version as developed and maintained by Thomas
E.\ Dickey.
This means that Chawan is compatible with any given terminal if:
.IP \(bu 2
the terminal is actually compatible with XTerm, OR
.IP \(bu 2
the terminal isn\(cqt compatible with XTerm, but reports its
capabilities via terminal queries correctly, OR
.IP \(bu 2
the terminal isn\(cqt compatible with XTerm, but its \f[CR]TERM\f[R]
value is hardcoded in Chawan.
.PP
Terminals pretending to be XTerm (\f[CR]TERM=xterm\f[R]) which are not
actually XTerm might malfunction.
.PP
(In practice, I have tested dozens of terminal emulators and haven\(cqt
encountered any major issues; in all likelihood, yours will work too.
If it doesn\(cqt, please \c
.UR https://todo.sr.ht/~bptato/chawan
open a ticket
.UE \c
\&.)
.SS Queries
Queries are preferred to hardcoded terminal descriptions because they
are forward\-compatible.
On startup, Chawan queries:
.IP \(bu 2
Whether the terminal has true color, with XTGETTCAP rgb.
.IP \(bu 2
The default background, foreground, and 16 ANSI(\-ish) colors with
\f[CR]OSC 10 ; ? ST\f[R], \f[CR]OSC 11 ; ? ST\f[R], and
\f[CR]OSC 4 ; {0..15} ; ? ST\f[R].
.IP \(bu 2
\f[CR]OSC 60 ST\f[R] and \f[CR]OSC 61 allowWindowOps ST\f[R] for
detecting OSC 52 support (see the \f[I]Clipboard\f[R] section).
.IP \(bu 2
Whether the terminal can use the Kitty image protocol, by sending a 1x1
Kitty image and listening for a response.
.IP \(bu 2
The number of Sixel color registers (\f[CR]CSI ? 1 ; 1 ; 0 $\f[R]).
.IP \(bu 2
Primary device attributes (DA1).
.IP \(bu 2
Text area and cell size using \f[CR]CSI 14 t\f[R] and
\f[CR]CSI 16 t\f[R].
(Cell size beats text area size as it is more reliable.)
.IP \(bu 2
Window size in cells by sending a CUP to 9999;9999 and then asking for
CPR (the same trick is used by resize(1)).
.PP
Chawan processes responses to the above query in the same state machine
as user input, so it works reasonably well on all terminals that at
least emulate the most basic VT100 function (CPR).
This unified state machine also minimizes the chance of user input being
mistaken for a query response (or vice versa).
.PP
Terminals that do not respond to CPR will freeze on quit \- in this
case, you must type \f[CR]C\-c\f[R] to forcibly kill the state machine.
In practice, FreeBSD\(cqs \f[B]vt\f[R](4) is the only one I\(cqve found
that exhibits this behavior; to add insult to injury, it claims to be an
\(lqxterm\(rq in TERM.
Therefore we discriminate between \f[B]vt\f[R](4) and a real XTerm using
an ioctl.
(Idea shamelessly stolen from notcurses\(cq Linux console detection).
.PP
Some terminals bleed the APC sequence used to recognize kitty image
support, and this may result in strange artifacts when no alt screen is
used.
On terminals that set TERM correctly, the APC sequence is not sent.
.SS Clipboard
Some terminals support sequences to override the clipboard.
Chawan differentiates between three tiers:
.IP "1." 3
Supports clipboard \f[I]and\f[R] primary selection.
The latter is what allows you on X11 to select some text with the mouse
and then middle\-click paste it elsewhere.
.RS 4
.PP
This applies to all terminals that respond to OSC 60/61 (XTerm) as well
as a hardcoded list of terminals that respond with 52 in DA1 and have
been confirmed to support the primary selection (Kitty).
.RE
.IP "2." 3
Supports clipboard, but may choke on trying to set primary selection.
.RS 4
.PP
This applies to terminals that include the number 52 in DA1.
This response guarantees nothing about support for the primary
selection, and indeed, some terminals that return it (Contour) behave
incorrectly when receiving primary.
.RE
.IP "3." 3
Does not support clipboard.
In this case we shell out to \f[CR]external.copy\-cmd\f[R] (defaults to
xsel).
.RS 4
.PP
This applies to all other terminals.
Notably, this includes terminals that support OSC 52 but do not have a
reliable mechanism to detect whether it actually works, such as
Alacritty.
.RE
.PP
It is possible to manually adjust OSC 52 use with the
\f[CR]input.osc52\-copy\f[R] and \f[CR]input.osc52\-primary\f[R]
configuration options.
.SS Ancient terminals
Most pre\-ECMA\-48 (1979) terminals are not expected to work.
.PP
There is some degree of ADM\-3A support, tested in Kragen Javier
Sitaker\(cqs \c
.UR https://gitlab.com/kragen/bubbleos
admu
.UE \c
\ emulator.
.PP
Some DEC terminals have also been tested in simulators of the original
hardware running the actual ROM:
.IP \(bu 2
The VT100 has been tested in Lars Brinkhoff\(cqs \c
.UR https://github.com/larsbrinkhoff/terminal-simulator
terminal\-simulator
.UE \c
\&.
.IP \(bu 2
The VT420 has been tested in Matt Mastracci\(cqs \c
.UR https://github.com/mmastrac/blaze
Blaze
.UE \c
\&.
.PP
Patches for other terminals (hardware or software alike) are welcome.
.SS Ancient character encodings
For ASCII\-only terminals, don\(cqt forget to
\f[CR]export LC_ALL=C\f[R].
For terminals supporting other legacy encodings, you may also have some
luck with \f[CR]language.charset\f[R], such as
\f[CR]export LC_ALL=ja_JP.ISO\-2022\-JP\f[R].
.PP
Note that Chawan uses its own encoding library instead of the
notoriously broken C locale facility, and the two sets of supported
charsets may not fully overlap.
You can test whether a charset is supported using
\f[CR]cha \-O {charset name} \-V\f[R].
.SS See also
\f[B]cha\f[R](1)
